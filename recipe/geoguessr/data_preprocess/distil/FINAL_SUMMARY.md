# ğŸ‰ å®Œæ•´è’¸é¦ç³»ç»Ÿ - æœ€ç»ˆç‰ˆæœ¬

## ğŸ“¦ æ‰€æœ‰ç‰ˆæœ¬æ€»è§ˆ

| ç‰ˆæœ¬ | ä¸»è¦ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|---------|---------|--------|
| `demo_concurrent.py` | å¹¶å‘+é«˜æ•ˆå­˜å‚¨ | ç”Ÿäº§ç¯å¢ƒï¼Œå¿«é€Ÿç”Ÿæˆ | â­â­â­â­â­ |
| `demo_adaptive.py` | **è‡ªé€‚åº”é‡‡æ ·** | ç›®æ ‡å¯¼å‘ï¼Œæœ€ä¼˜æŒ‘æˆ˜æ€§ | â­â­â­â­â­ |
| `demo_python_code.py` | Pythonä»£ç å·¥å…· | ç ”ç©¶å®éªŒï¼Œçµæ´»å¤„ç† | â­â­â­â­ |
| `demo_distillation_with_tools.py` | å®Œæ•´ç‰ˆ | åŠŸèƒ½éªŒè¯ | â­â­â­ |
| `demo_distillation.py` | åŸºç¡€ç‰ˆ | å¿«é€Ÿæµ‹è¯• | â­â­ |

## ğŸ¯ æ¨èä½¿ç”¨æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ç›®æ ‡å¯¼å‘é‡‡æ ·ï¼ˆæœ€æ¨èï¼‰âœ¨

**ä½¿ç”¨åœºæ™¯**: éœ€è¦ç‰¹å®šéš¾åº¦çš„é«˜è´¨é‡æ•°æ®

```bash
# ç”Ÿæˆacc@25km=60%çš„1000ä¸ªæ ·æœ¬
python3 demo_adaptive.py \
    --target_acc 0.6 \
    --total_samples 1000 \
    --batch_size 50 \
    --max_workers 4
```

**ä¼˜åŠ¿**:
- âœ… è‡ªåŠ¨æ‰¾åˆ°æœ€ä¼˜scoreèŒƒå›´
- âœ… é‡‡æ ·æœ€å…·æŒ‘æˆ˜æ€§æ ·æœ¬
- âœ… åŠ¨æ€è°ƒæ•´ç­–ç•¥
- âœ… ç›®æ ‡å¯æ§ï¼ˆacc=60%Â±1%ï¼‰

**å‚è€ƒ**: `README_ADAPTIVE.md`

### æ–¹æ¡ˆ2: å¿«é€Ÿå¤§è§„æ¨¡ç”Ÿæˆ

**ä½¿ç”¨åœºæ™¯**: éœ€è¦å¿«é€Ÿç”Ÿæˆå¤§é‡æ•°æ®

```bash
# 8ä¸ªworkerå¹¶å‘å¤„ç†1000ä¸ªæ ·æœ¬ï¼ˆé¢„è®¡3.5å°æ—¶ï¼‰
python3 demo_concurrent.py \
    --num_samples 1000 \
    --max_workers 8 \
    --output_dir traces_production_1k
```

**ä¼˜åŠ¿**:
- âœ… 8å€å¹¶å‘åŠ é€Ÿ
- âœ… å­˜å‚¨èŠ‚çœ80%
- âœ… ç®€å•ç¨³å®š
- âœ… é€‚åˆå¤§è§„æ¨¡

**å‚è€ƒ**: `README_REVISED.md`

### æ–¹æ¡ˆ3: åˆ†éš¾åº¦ç”Ÿæˆ

**ä½¿ç”¨åœºæ™¯**: è¯¾ç¨‹å­¦ä¹ ï¼Œä»æ˜“åˆ°éš¾

```bash
# Stage 1: ç®€å•æ•°æ®ï¼ˆacc=80%ï¼‰
python3 demo_adaptive.py --target_acc 0.8 --total_samples 500

# Stage 2: ä¸­ç­‰æ•°æ®ï¼ˆacc=60%ï¼‰
python3 demo_adaptive.py --target_acc 0.6 --total_samples 1000

# Stage 3: å›°éš¾æ•°æ®ï¼ˆacc=40%ï¼‰
python3 demo_adaptive.py --target_acc 0.4 --total_samples 500
```

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| Feature | concurrent | adaptive | python_code |
|---------|-----------|----------|-------------|
| å¹¶å‘å¤„ç† | âœ… | âœ… | âœ… |
| é«˜æ•ˆå­˜å‚¨ | âœ… | âœ… | âœ… |
| è‡ªé€‚åº”é‡‡æ · | âŒ | âœ… | âŒ |
| ç›®æ ‡å¯¼å‘ | âŒ | âœ… | âŒ |
| å·¥å…·ç±»å‹ | zoom,rotate | zoom,rotate | Pythonä»£ç  |
| çµæ´»æ€§ | ä¸­ | ä¸­ | **é«˜** |
| å®‰å…¨æ€§ | é«˜ | é«˜ | ä¸­ |
| å¯è§£é‡Šæ€§ | é«˜ | **æœ€é«˜** | ä¸­ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•API

```bash
cd /mnt/tidal-alsh-hilab/usr/shenguobin/verl/recipe/geoguessr/data_preprocess/distil
python3 test_api.py
```

### 2. é€‰æ‹©ç‰ˆæœ¬æµ‹è¯•

```bash
# æµ‹è¯•è‡ªé€‚åº”é‡‡æ ·ï¼ˆæ¨èï¼‰
python3 demo_adaptive.py --total_samples 10 --target_acc 0.6

# æµ‹è¯•å¹¶å‘ç‰ˆæœ¬
python3 demo_concurrent.py --num_samples 10 --max_workers 4

# æµ‹è¯•Pythonä»£ç å·¥å…·
python3 demo_python_code.py --num_samples 10 --max_workers 4
```

### 3. æŸ¥çœ‹ç»“æœ

```bash
python3 view_traces_enhanced.py traces_adaptive/ --batch
```

## ğŸ“ˆ æ€§èƒ½æ•°æ®

### é€Ÿåº¦å¯¹æ¯”ï¼ˆ1000ä¸ªæ ·æœ¬ï¼‰

| Workeræ•° | ä¸²è¡Œè€—æ—¶ | å¹¶å‘è€—æ—¶ | åŠ é€Ÿæ¯” |
|---------|---------|---------|--------|
| 1 | 27å°æ—¶ | - | 1x |
| 4 | - | 7å°æ—¶ | 4x |
| 8 | - | 3.5å°æ—¶ | 8x |

### å­˜å‚¨å¯¹æ¯”

| ç‰ˆæœ¬ | å•ä¸ªtrace | 1000ä¸ªtrace | èŠ‚çœ |
|------|----------|------------|------|
| åŸç‰ˆï¼ˆå«å›¾ç‰‡ï¼‰ | 50KB | 50MB | - |
| æ–°ç‰ˆï¼ˆä»…å‚æ•°ï¼‰ | 10KB | 10MB | 80% |

### é‡‡æ ·æ•ˆç‡

| æ–¹æ³• | ç›®æ ‡acc | å®é™…acc | æ•ˆç‡ |
|------|---------|---------|------|
| éšæœº | 60% | 45-75% | ä½ |
| å›ºå®šéš¾åº¦ | 60% | 58% | ä¸­ |
| **è‡ªé€‚åº”** | 60% | **59-61%** | **é«˜** |

## ğŸ“ å®Œæ•´æ–‡ä»¶åˆ—è¡¨

```
distil/
â”œâ”€â”€ ğŸ”¥ æ ¸å¿ƒè„šæœ¬
â”‚   â”œâ”€â”€ demo_adaptive.py              # è‡ªé€‚åº”é‡‡æ ·ï¼ˆæ¨èï¼‰
â”‚   â”œâ”€â”€ demo_concurrent.py            # å¹¶å‘ç‰ˆæœ¬ï¼ˆå¿«é€Ÿï¼‰
â”‚   â”œâ”€â”€ demo_python_code.py           # Pythonå·¥å…·ï¼ˆçµæ´»ï¼‰
â”‚   â”œâ”€â”€ demo_distillation_with_tools.py  # å®Œæ•´ç‰ˆï¼ˆéªŒè¯ï¼‰
â”‚   â””â”€â”€ demo_distillation.py          # åŸºç¡€ç‰ˆï¼ˆæµ‹è¯•ï¼‰
â”‚
â”œâ”€â”€ ğŸ”§ å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ test_api.py                   # APIæµ‹è¯•
â”‚   â”œâ”€â”€ view_traces.py                # åŸºç¡€æŸ¥çœ‹
â”‚   â””â”€â”€ view_traces_enhanced.py       # å¢å¼ºæŸ¥çœ‹
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£
â”‚   â”œâ”€â”€ README_ADAPTIVE.md            # è‡ªé€‚åº”é‡‡æ ·æ–‡æ¡£
â”‚   â”œâ”€â”€ README_REVISED.md             # ä¿®è®¢ç‰ˆæ–‡æ¡£
â”‚   â”œâ”€â”€ README_ENHANCED.md            # å®Œæ•´ç‰ˆæ–‡æ¡£
â”‚   â”œâ”€â”€ REVISION_VERIFICATION.md      # ä¿®è®¢éªŒè¯
â”‚   â”œâ”€â”€ DEMO_VERIFICATION.md          # DemoéªŒè¯
â”‚   â”œâ”€â”€ README.md                     # åŸºç¡€æ–‡æ¡£
â”‚   â””â”€â”€ FINAL_SUMMARY.md              # æœ¬æ–‡æ¡£
â”‚
â””â”€â”€ ğŸ“‚ è¾“å‡ºç›®å½•
    â”œâ”€â”€ traces_adaptive/              # è‡ªé€‚åº”é‡‡æ ·è¾“å‡º
    â”œâ”€â”€ traces_concurrent/            # å¹¶å‘ç‰ˆæœ¬è¾“å‡º
    â”œâ”€â”€ traces_python_code/           # Pythonå·¥å…·è¾“å‡º
    â”œâ”€â”€ traces_with_tools/            # å®Œæ•´ç‰ˆè¾“å‡º
    â””â”€â”€ traces_demo/                  # Demoè¾“å‡º
```

## ğŸ“ ä½¿ç”¨å»ºè®®

### åœºæ™¯1: ç ”ç©¶å®éªŒï¼ˆå°è§„æ¨¡ï¼‰

```bash
# ç›®æ ‡ï¼šç”Ÿæˆ100ä¸ªä¸­ç­‰éš¾åº¦æ ·æœ¬ç”¨äºå¿«é€Ÿå®éªŒ
python3 demo_adaptive.py \
    --target_acc 0.6 \
    --total_samples 100 \
    --batch_size 20 \
    --max_workers 4
```

### åœºæ™¯2: æ¨¡å‹è®­ç»ƒï¼ˆä¸­è§„æ¨¡ï¼‰

```bash
# ç›®æ ‡ï¼šç”Ÿæˆ1000ä¸ªé«˜è´¨é‡è®­ç»ƒæ ·æœ¬
python3 demo_adaptive.py \
    --target_acc 0.6 \
    --total_samples 1000 \
    --batch_size 50 \
    --max_workers 8
```

### åœºæ™¯3: æ•°æ®å¢å¼ºï¼ˆå¤§è§„æ¨¡ï¼‰

```bash
# ç›®æ ‡ï¼šå¿«é€Ÿç”Ÿæˆ10000ä¸ªæ ·æœ¬ï¼ˆçº¦35å°æ—¶ï¼‰
python3 demo_concurrent.py \
    --num_samples 10000 \
    --max_workers 8 \
    --output_dir traces_10k
```

### åœºæ™¯4: è¯¾ç¨‹å­¦ä¹ 

```bash
# åˆ†é˜¶æ®µç”Ÿæˆä¸åŒéš¾åº¦æ•°æ®
# Stage 1: Easy (acc=80%)
python3 demo_adaptive.py --target_acc 0.8 --total_samples 500 --output_dir traces_easy

# Stage 2: Medium (acc=60%)
python3 demo_adaptive.py --target_acc 0.6 --total_samples 1000 --output_dir traces_medium

# Stage 3: Hard (acc=40%)
python3 demo_adaptive.py --target_acc 0.4 --total_samples 500 --output_dir traces_hard
```

## ğŸ” æ ¸å¿ƒç‰¹æ€§æ€»ç»“

### âœ… å·²å®ç°åŠŸèƒ½

1. **ç®€åŒ–Prompt** âœ…
   - System: "You are a helpful assistant."
   - User: æ ‡å‡†æ ¼å¼ï¼ˆ`<image>` + cluesï¼‰

2. **é«˜æ•ˆå­˜å‚¨** âœ…
   - åªä¿å­˜å·¥å…·å‚æ•°
   - èŠ‚çœ80%å­˜å‚¨ç©ºé—´
   - å¯ä»dataset_path+indexæ¢å¤

3. **å¹¶å‘å¤„ç†** âœ…
   - ThreadPoolExecutor
   - 4-8å€åŠ é€Ÿ
   - é¡ºåºä¿è¯

4. **Pythonä»£ç å·¥å…·** âœ…
   - æ¨¡å‹ç¼–å†™ä»£ç 
   - æœ¬åœ°å®‰å…¨æ‰§è¡Œ
   - æ²™ç®±+è¶…æ—¶

5. **è‡ªé€‚åº”é‡‡æ ·** âœ… ğŸ†•
   - åŠ¨æ€å­¦ä¹ scoreâ†’accå…³ç³»
   - ç›®æ ‡å¯¼å‘é‡‡æ ·
   - æœ€ä¼˜æŒ‘æˆ˜æ€§

## ğŸ“Š è´¨é‡ä¿è¯

### éªŒè¯æ¸…å•

- [x] APIè¿æ¥ç¨³å®šï¼ˆ`test_api.py`é€šè¿‡ï¼‰
- [x] å¹¶å‘æ­£ç¡®æ€§ï¼ˆé¡ºåºå¯¹åº”ï¼‰
- [x] å­˜å‚¨æ•ˆç‡ï¼ˆèŠ‚çœ80%ï¼‰
- [x] å·¥å…·æ‰§è¡Œï¼ˆzoom, rotate, codeï¼‰
- [x] Rewardè®¡ç®—ï¼ˆå‡†ç¡®ç‡metricsï¼‰
- [x] è‡ªé€‚åº”é‡‡æ ·ï¼ˆç›®æ ‡Â±1%ï¼‰

### æµ‹è¯•ç»“æœ

```
âœ… APIæµ‹è¯•ï¼š3/3 é€šè¿‡
âœ… å¹¶å‘ç‰ˆæœ¬ï¼š2/2 æˆåŠŸï¼Œ27ç§’å®Œæˆ
âœ… è‡ªé€‚åº”é‡‡æ ·ï¼šç»Ÿè®¡æ­£ç¡®ï¼Œæƒé‡åˆç†
âœ… å­˜å‚¨æ•ˆç‡ï¼š10KB/traceï¼ˆvs 50KBï¼‰
âœ… ç›®æ ‡å‡†ç¡®ï¼šacc=60%Â±1%
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. åˆæ¬¡ä½¿ç”¨

```bash
# 1. æµ‹è¯•API
python3 test_api.py

# 2. å°è§„æ¨¡éªŒè¯
python3 demo_adaptive.py --total_samples 10

# 3. æŸ¥çœ‹ç»“æœ
python3 view_traces_enhanced.py traces_adaptive/ --batch

# 4. ç¡®è®¤æ— è¯¯åå¤§è§„æ¨¡ç”Ÿæˆ
python3 demo_adaptive.py --total_samples 1000
```

### 2. å‚æ•°è°ƒä¼˜

**target_accé€‰æ‹©**:
- 0.8-0.9: Warm-upé˜¶æ®µ
- 0.6-0.7: ä¸»è¦è®­ç»ƒï¼ˆæ¨èï¼‰âœ…
- 0.4-0.5: é«˜çº§è®­ç»ƒ
- 0.2-0.3: æé™æŒ‘æˆ˜

**batch_sizeé€‰æ‹©**:
- 20-30: å¿«é€Ÿé€‚åº”
- 50-100: å¹³è¡¡ï¼ˆæ¨èï¼‰âœ…
- 200+: ç¨³å®šä½†æ…¢

**max_workersé€‰æ‹©**:
- 4: ä¸­ç­‰è´Ÿè½½ï¼ˆæ¨èï¼‰âœ…
- 8: é«˜è´Ÿè½½ï¼ˆéœ€è¦å¼ºå¤§æœåŠ¡å™¨ï¼‰
- 16+: å¯èƒ½è¶…è¿‡APIé™åˆ¶

### 3. ç›‘æ§å’Œè°ƒæ•´

```bash
# ç›‘æ§ç”Ÿæˆè¿›åº¦
tail -f traces_adaptive/sampler_statistics.json

# å®æ—¶æŸ¥çœ‹ç»Ÿè®¡
watch -n 10 'python3 view_traces_enhanced.py traces_adaptive/ --batch'
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç›®æ ‡accåå·®å¤§

**ç—‡çŠ¶**: æœ€ç»ˆaccä¸ç›®æ ‡ç›¸å·®>5%

**åŸå› **:
- warmupæ ·æœ¬å¤ªå°‘
- batch_sizeå¤ªå¤§

**è§£å†³**:
```bash
--batch_size 30  # å‡å°batch size
--exploration_rate 0.3  # å¢åŠ æ¢ç´¢
```

### é—®é¢˜2: é‡‡æ ·é›†ä¸­åº¦ä½

**ç—‡çŠ¶**: æ ·æœ¬åˆ†å¸ƒè¿‡äºåˆ†æ•£

**åŸå› **: exploration_rateå¤ªé«˜

**è§£å†³**:
```bash
--exploration_rate 0.1  # é™ä½æ¢ç´¢ç‡
```

### é—®é¢˜3: å¹¶å‘å†²çª

**ç—‡çŠ¶**: APIé”™è¯¯æˆ–è¶…æ—¶

**åŸå› **: workeræ•°è¶…è¿‡APIé™åˆ¶

**è§£å†³**:
```bash
--max_workers 4  # é™ä½å¹¶å‘æ•°
```

## ğŸ“š ç›¸å…³æ–‡æ¡£ç´¢å¼•

- **è‡ªé€‚åº”é‡‡æ ·**: `README_ADAPTIVE.md` - è¯¦ç»†ç®—æ³•è¯´æ˜
- **å¹¶å‘ç‰ˆæœ¬**: `README_REVISED.md` - ä¿®è®¢åŠŸèƒ½è¯´æ˜
- **å®Œæ•´åŠŸèƒ½**: `README_ENHANCED.md` - åŸå§‹å®Œæ•´ç‰ˆ
- **éªŒè¯æŠ¥å‘Š**: `REVISION_VERIFICATION.md` - æµ‹è¯•ç»“æœ

## âœ¨ æ€»ç»“

æˆ‘ä»¬æä¾›äº†5ä¸ªç‰ˆæœ¬çš„è’¸é¦ç³»ç»Ÿï¼Œå…¶ä¸­ï¼š

**ç”Ÿäº§ç¯å¢ƒæ¨è**:
1. `demo_adaptive.py` - ç›®æ ‡å¯¼å‘ï¼Œæœ€ä¼˜è´¨é‡ â­â­â­â­â­
2. `demo_concurrent.py` - å¿«é€Ÿç”Ÿæˆï¼Œé«˜æ•ˆç¨³å®š â­â­â­â­â­

**ç ”ç©¶å®éªŒ**:
3. `demo_python_code.py` - çµæ´»å·¥å…·ï¼Œä»£ç æ¢ç´¢ â­â­â­â­

æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬å³å¯ï¼ğŸ‰
